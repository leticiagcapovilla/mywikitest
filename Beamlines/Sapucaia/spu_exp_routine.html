<!--
title: Sapucaia Experimental Routine
description: 
published: 1
date: 2024-09-10T13:29:41.759Z
tags: 
editor: ckeditor
dateCreated: 2024-09-04T15:56:07.754Z
-->

<h1>Início do tempo de feixe</h1>
<p>&nbsp;</p>
<h2>Escolha do setup da linha (1x por proposta) [staff]</h2>
<ul>
  <li>Alinhamento de porta-amostra e fendas (varreduras de motores)</li>
  <li>Alinhamento do beamstopper (varredura de motores)<br>&nbsp;</li>
</ul>
<h2>Escolha de energia da linha (1x por proposta) [staff]</h2>
<ul>
  <li>Mudança nos motores do DCM (varredura de motores)</li>
  <li>Realinhamento do porta-amostras e fendas, caso necessário (varredura de motores)</li>
</ul>
<p>&nbsp;</p>
<h2>Escolha da distância amostra-detector (1x ou 2x por proposta) [usuário + staff presente]</h2>
<p>&nbsp;</p>
<ul>
  <li>Ajuste fino das configurações do experimento usando amostra padrão (AgBh)<ul>
      <li>Coleta da imagem do padrão (auto) – não requer altas velocidades (usar escrita em PVs)<ul>
          <li>Posicionamento da amostra padrão na frente do feixe (movimentação xy do porta-amostra – slider e bioy)</li>
          <li>Abertura do fast shutter</li>
          <li>Início da aquisição pelo detector</li>
          <li>Finalização da aquisição pelo detector</li>
          <li>Fechamento do fast shutter</li>
          <li>Retorno dos motores para o reposicionamento da amostra</li>
          <li>Todas etapas podem ser feitas usando a escrita nas PVs dos elementos</li>
        </ul>
      </li>
      <li>Utilização da imagem do padrão para calibração da distância [staff]<ul>
          <li>Uso de software de terceiros (pyFAI)</li>
          <li>Obtenção das variáveis para reconstrução geométrica do detector</li>
          <li>Estas etapas não incluem</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<p>&nbsp;</p>
<ul>
  <li>Preparação da máscara para integração dos dados [staff]<ul>
      <li>Combinação da informação de pixeis problemáticos com pixeis removidos exclusivamente para o experimento (beamstopper/sombras/espalhamentos indesejados)</li>
      <li>Uso de software de terceiros (pyFAI)</li>
    </ul>
  </li>
</ul>
<h1>Início das medidas</h1>
<p>&nbsp;</p>
<h2>Escolha dos parâmetros da medida [usuário]</h2>
<ul>
  <li>Posição das amostras nas placas (setups 1, 2, 3, 4 e 7)</li>
  <li>Volume de amostra para coleta (setups 1 e 3)</li>
  <li>Nome das amostras (1x por medida) (todos)</li>
  <li>Temperatura (setups 1, 3, 4 e 7)</li>
  <li>Tempo de exposição (todos)</li>
  <li>Quantidade de medições (todos)<ul>
      <li>Período da coleta (todos)</li>
    </ul>
  </li>
</ul>
<p>&nbsp;</p>
<h2>Disparo da medida [usuário]</h2>
<ul>
  <li>Medida do I0 (auto)<ul>
      <li>Introdução do fotodiodo (antes da amostra) – Atuador pneumático– escrever em PV​</li>
      <li>Abertura do Fast Shutter – escrever em PV</li>
      <li>Aquisição das contagens no fotodiodo<ul>
          <li>Medida de 1 s, por exemplo: resolução temporal da medida e range dinâmico do fotodiodo precisam ser muito bons para que a subtração dos dados seja feita de forma aceitável. Idealmente 1 em 104 ou 105, pelo menos.</li>
        </ul>
      </li>
      <li>Fechamento do Fast Shutter</li>
      <li>Remoção do fotodiodo</li>
    </ul>
  </li>
  <li>Inclusão da amostra na frente do feixe (dependente do setup)</li>
</ul>
<h1>SETUP 1 - biocube</h1>
<p>&nbsp;</p>
<h2>Posicionamento da amostra na frente do feixe – parte 1</h2>
<p>&nbsp;</p>
<h3>Injeção da amostra (auto)</h3>
<ul>
  <li>Robô #1 faz a coleta da amostra e injeta na célula (biocube) e fica on hold (movimentação via software xenocs) – t(20-40s)</li>
  <li>Bomba de seringa posiciona a amostra no capilar (região vista pela câmera) até a amostra ficar na região onde será exposta (movimentação via software xenocs) – t(2-5s) (*1)<ul>
      <li>Movimento passa a ser controlado pelo feedback da câmera (*2)</li>
    </ul>
  </li>
  <li>Coloca-se a temperatura do sistema na temperatura de medida (mudança via software xenocs) – t(0 – 2min)</li>
</ul>
<p>&nbsp;</p>
<h3>Medidas de UV-Vis são realizadas para a amostra (auto) – t&lt;1s</h3>
<ul>
  <li>(trigger através do software da xenocs)</li>
  <li>Informações devem ser gravadas no HDF5 da amostra</li>
</ul>
<p>&nbsp;</p>
<h3>Medidas de raios X (auto)</h3>
<ul>
  <li>Amostra é posicionada numa região onde o feixe de raios X incide sobre ela. (*1, já estava)​</li>
  <li>É feito o cálculo da velocidade do líquido para a realização do experimento (para evitar o desperdício e aproveitar ao máximo o volume escolhido da amostra) – esta etapa não existe, mas precisaríamos que existisse. Precisamos de alguma sugestão.</li>
  <li>Coloca-se a amostra em movimento (utilizando a bomba de seringa) (*2) – o comando para mover a bomba de seringa é enviado</li>
  <li>No momento que o software da câmera reconhece que o líquido iniciou a movimentação (pois pode haver um delay entre a movimentação da bomba de seringa e a efetiva movimentação do menisco), é disparado o processo de abertura do fast shutter (FS).<ul>
      <li>O tempo entre o início da movimentação do menisco e o disparo do processo de abertura do FS é de extrema importância, pois se houver um tempo muito grande, haverá um desperdício grande de amostra; por outro lado, se o líquido não iniciar seu movimento, o feixe pode queimar a amostra antes dela começar a movimentar com velocidade terminal.</li>
      <li>De forma geral, a velocidade da bomba de seringa é de aproximadamente 10 ul/s; o tempo do EPICS para ativar este processo faria com que houvesse a perda de aproximadamente uns 2 ul. Considerando a mesma perda para o fim do menisco, seria um desperdício de 4 ul, o que não é um grande problema. Os valores de velocidade da bomba e do EPICS precisam ser atualizados para uma melhor estimativa; porém, para agora, acreditamos que se o tratamento de imagem for rápido (~ 0.1s), a perda de amostra seria pequena, e seria possível fazer o experimento com menos de 10 ul, de forma geral.</li>
    </ul>
  </li>
  <li>É enviado um sinal para o fast shutter para a realização de sua abertura<ul>
      <li>O fast shutter será chamado pelo TATU para que o mesmo abra. O tempo de delay de abertura é de aproximadamente 7 ms depois do sinal chegar ao FS.</li>
      <li>Há uma medida analógica de resistência que informa se o FS abriu totalmente ou não. O sinal de abertura (quando passa um valor de threshold) comandará o início de aquisição dos dados do detector</li>
    </ul>
  </li>
</ul>
<p>&nbsp;</p>
<h2>Posicionamento da amostra na frente do feixe – parte 2</h2>
<ul>
  <li>O fast shutter, quando aberto, envia um sinal para o TATU, e este para o detector, para o último iniciar a aquisição dos dados – sinal instantâneo do TATU<ul>
      <li>Os dados são coletados respeitando o tempo de aquisição, quantidade de medições e período de coleta</li>
      <li>Dependendo do período de coleta e do tempo de aquisição, o FS pode ser fechado.</li>
      <li>Idealmente, o experimento deveria ser interrompido caso fosse identificado que o menisco do fim da amostra chegou antes do previsto (formação de bolhas ou insuficiência de amostra) – necessário reconhecimento de imagem para este ponto.</li>
      <li>Dados da temperatura da amostra são salvos</li>
    </ul>
  </li>
  <li>O detector faz a coleta dos dados e os salva no servidor.</li>
  <li>O detector para de fazer as coletas e envia sinal para fast shutter (via TATU)</li>
  <li>O fast shutter é fechado (delay de aproximadamente 7ms depois do sinal chegar nele)</li>
  <li>A amostra para de ser movimentada pela bomba de seringa – não precisa ser imediata a parada.</li>
  <li>A bomba de seringa para de ser controlada pelo feedback da câmera</li>
</ul>
<p>&nbsp;</p>
<h2>Limpeza do porta-amostras (auto)</h2>
<ul>
  <li>O robô conecta no biocube para fazer a limpeza</li>
  <li>A válvula do posicionador é colocada no sistema de bypass</li>
  <li>A amostra é descartada usando as bomba peristálticas do rack líquido</li>
  <li>As bombas peristálticas empurram os líquidos para limpeza (água, sabão e álcool)</li>
  <li>É aberto o circuito para a passagem de N2 para secagem</li>
  <li>Teste de imagem para verificação da correta limpeza do capilar: (não necessita TATU, mas pode ser usado)<ul>
      <li>O fast shutter é aberto</li>
      <li>O detector realiza uma medida com tempo determinado</li>
      <li>O fast shutter é fechado</li>
      <li>A imagem coletada é processada e comparada com a imagem do capilar no início do experimento<ul>
          <li>Caso haja diferença entre as medidas, é rodado outro ciclo de limpeza e secagem</li>
          <li>Se mesmo assim houver diferença, é indicado um alerta para troca de posição do feixe no capilar e, caso não resolver, troca do capilar</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<p>&nbsp;</p>
<h2>Inicia-se um novo ciclo de experimento.</h2>
<h1>SETUP 2 - Placa</h1>
<p>&nbsp;</p>
<h2>Posicionamento da amostra na frente do feixe</h2>
<p>&nbsp;</p>
<h3>Posicionamento da amostra (auto)</h3>
<ul>
  <li>Robô #2 faz a coleta da placa que contém a amostra escolhida e posiciona a amostra escolhida na frente do feixe<ul>
      <li>Não tem bomba peristáltica, temperatura, lavagem, medida de UV-Vis, sem feedback nem nada. O experimento é acompanhado pela câmera da linha para inspeção visual.</li>
    </ul>
  </li>
</ul>
<p>&nbsp;</p>
<h3>Medidas de raios X (auto)</h3>
<ul>
  <li>É enviado um sinal para o fast shutter para a realização de sua abertura (não precisa do TATU, mas pode ser feito como no anterior)</li>
  <li>O fast shutter, quando aberto, envia um sinal para o detector iniciar a aquisição dos dados<ul>
      <li>Os dados são coletados respeitando o tempo de aquisição, quantidade de medições e período de coleta</li>
      <li>Dependendo do período de coleta e do tempo de aquisição, o fast shutter pode ser fechado.</li>
    </ul>
  </li>
  <li>O detector faz a coleta dos dados e os salva no servidor.</li>
  <li>O detector para de fazer as coletas e envia sinal para fast shutter</li>
  <li>O fast shutter é fechado</li>
</ul>
<p>&nbsp;</p>
<h2>Inicia-se um novo ciclo de experimento</h2>
<h1>SETUP 3 – Capivara (ainda não pensado como será daqui para frente)</h1>
<p>&nbsp;</p>
<h2>Posicionamento da amostra na frente do feixe – parte 1</h2>
<p>&nbsp;</p>
<h3>Injeção da amostra (auto)</h3>
<ul>
  <li>Robô #3 (Alias?) faz a coleta da amostra e injeta na célula (Capivara) usando uma bomba peristáltica​</li>
  <li>O injetor com seringa, que possui maior precisão, suga a amostra para o capilar (região vista pela câmera) até a amostra ficar próxima à região onde será exposta.</li>
  <li>O injetor com seringa passa a ser controlado pelo feedback da câmera</li>
  <li>Coloca-se a temperatura do sistema na temperatura de medida</li>
  <li>A temperatura da amostra é monitorada pela câmera térmica.</li>
</ul>
<p>&nbsp;</p>
<h3>Medidas de UV-Vis são realizadas para a amostra (auto)</h3>
<p>&nbsp;</p>
<h3>Medidas de raios X (auto)</h3>
<ul>
  <li>É feito o cálculo da velocidade do líquido para a realização do experimento (para evitar o desperdício e aproveitar ao máximo o volume escolhido da amostra)</li>
  <li>Coloca-se a amostra em movimento (utilizando a seringa motorizada)</li>
  <li>No momento que o software reconhece que o líquido passa pela região de iluminação do feixe, é disparado o processo de abertura do fast shutter (processo idêntico ao da xenocs)</li>
  <li>É enviado um sinal para o fast shutter para a realização de sua abertura (TATU)</li>
  <li>O fast shutter, quando aberto, envia um sinal para o detector iniciar a aquisição dos dados<ul>
      <li>Os dados são coletados respeitando o tempo de aquisição, quantidade de medições e período de coleta</li>
      <li>Dependendo do período de coleta e do tempo de aquisição, o fast shutter pode ser fechado.</li>
      <li>O experimento é interrompido caso seja identificado que o menisco chegou antes do previsto (formação de bolhas ou insuficiência de amostra)</li>
      <li>Dados da temperatura da amostra também são salvos</li>
    </ul>
  </li>
  <li>O detector faz a coleta dos dados e os salva no servidor.</li>
  <li>O detector para de fazer as coletas e envia sinal para fast shutter</li>
  <li>O fast shutter é fechado</li>
  <li>A amostra para de ser movimentada pelo injetor, e o injetor para de ser comandado pelo feedback da câmera</li>
</ul>
<p>&nbsp;</p>
<h2>Limpeza do porta-amostras (auto)</h2>
<ul>
  <li>As válvulas são acionadas para a bomba peristáltica controlar o líquido</li>
  <li>A amostra é descartada usando a bomba peristáltica</li>
  <li>Uma válvula é acionada para usar os líquidos de limpeza (água e, depois, água com sabão)</li>
  <li>Uma bomba peristáltica empurra os líquidos para limpeza (água e sabão), alternando uma outra válvula entre os líquidos</li>
  <li>É aberto o circuito para a passagem de N2 para secagem (válvulas acionadas)</li>
  <li>Teste de imagem para verificação da correta limpeza do capilar:<ul>
      <li>O fast shutter é aberto</li>
      <li>O detector realiza uma medida com tempo determinado</li>
      <li>O fast shutter é fechado​</li>
      <li>A imagem coletada é processada e comparada com a imagem do capilar no início do experimento​<ul>
          <li>Caso haja diferença entre as medidas, é rodado outro ciclo de limpeza e secagem​</li>
          <li>Se mesmo assim houver diferença, é indicado um alerta para troca de posição do feixe no capilar e, caso não resolver, troca do capilar</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<p>&nbsp;</p>
<h2>Inicia-se um novo ciclo de experimento.</h2>
<h1>SETUP 7 – Multicapilar</h1>
<p>&nbsp;</p>
<h2>Posicionamento da amostra na frente do feixe</h2>
<p>&nbsp;</p>
<h3>Posicionamento da amostra (auto)</h3>
<ul>
  <li>Robô #2 faz a coleta do Holder do multicapilar que contém a amostra escolhida e posiciona a amostra escolhida na frente do feixe</li>
  <li>A temperatura do Holder é setada para a do experimento.<ul>
      <li>Não tem bomba peristáltica, lavagem, medida de UV-Vis, sem feedback nem nada, a não ser o termopar. O experimento é acompanhado pela câmera da linha para inspeção visual.</li>
    </ul>
  </li>
</ul>
<p>&nbsp;</p>
<h3>Medidas de raios X (auto)</h3>
<ul>
  <li>É enviado um sinal para o fast shutter para a realização de sua abertura (não precisa do TATU, mas pode ser feito como no anterior)</li>
  <li>O fast shutter, quando aberto, envia um sinal para o detector iniciar a aquisição dos dados<ul>
      <li>Os dados são coletados respeitando o tempo de aquisição, quantidade de medições e período de coleta</li>
      <li>Dependendo do período de coleta e do tempo de aquisição, o fast shutter pode ser fechado.</li>
    </ul>
  </li>
  <li>O detector faz a coleta dos dados e os salva no servidor.</li>
  <li>O detector para de fazer as coletas e envia sinal para fast shutter</li>
  <li>O fast shutter é fechado</li>
</ul>
<p>&nbsp;</p>
<h2>Inicia-se um novo ciclo de experimento</h2>
