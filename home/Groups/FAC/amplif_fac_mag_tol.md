---
title: amplif_fac_mag_tol
description: 
published: 1
date: 2024-02-29T12:39:25.310Z
tags: 
editor: markdown
dateCreated: 2024-02-28T20:57:51.634Z
---

# FAC: Amplification Factors and Magnet Tolerances

### Introduction

In this section the alignment and excitation error tolerances for the Sirius storage ring magnets will be studied by the analysis of their orbit and optics distortion amplification factors.

### Amplification Factors

Disturbances in the ring with respect to the ideal machine generate responses which are, in most cases, linear with the disturbance strength. For example, lets consider one quadrupole with a horizontal alignment error $\delta _i$, where the index $i$ refers to the position of the quadrupole in the ring. Such error will generate a closed orbit residue of the form:

$x_i(s) = \frac{\delta_i k \sqrt{\beta(s_i)\beta(s)}\cos(\phi(s)-\phi(s_i) - \pi\nu)}{2\sin(\pi\nu)}.$

where $k$ is the integrated quadrupole strength. In a more general way, we could represent this orbit as $x_i(s) = f_i(s)\delta_i$, where $f_i(s)$ does not depend on the value of the error or on errors of other elements.

The residue presented above is changed in the presence of an orbit correction system, because the correctors strengths are such that the rms of the orbit in the bpms position is a minimum. In other words, they would be the solution of the following linear system:

$f_i(s_k)\delta_i = \sum_j c_{ji}f_j(s_k).$

where the index $k$ refers to the bpm positions and $c_{ji}$ is the strength of the $j$-th corrector in response for the horizontal alignment error on the $i$-th element. The determination of $c_{ji}$ is not trivial and is generally made by SVD decomposition of the $f_j(s_k)$ matrix. However, whichever the solution, it must be proportional to the error $\delta_i$, which means we can redefine the matrix $c_{ji}$ to $c_{ji}\delta_i$. Thus, the total orbit distortion generated by an alignment error on the quadrupole is given by:

$x_i(s) = \left(f_i(s) + \sum_j c_{ji}f_j(s)\right)\delta_i = g_i(s)\delta_i.$

Now, lets consider all the quadrupoles with alignment errors. The resulting orbit distortion in the ring is given by 

$x(s) = \sum_i x_i(s) = \sum_i g_i(s)\delta_i \Rightarrow x^2(s) = \sum_{i,j} g_i(s)g_j(s)\delta_i\delta_j.$

Assuming the errors are random variables following distributions with zero mean, the expected value for the residual orbit of an ensemble $E$ of machines is

$\langle x^2(s)\rangle_E = \sum_{i,j} g_i(s)g_j(s)\langle\delta_i\delta_j\rangle_E$

where $\langle\delta_i\delta_j\rangle_E$ is the covariance matrix of the ensemble. Assuming uncorrelated errors and taking the average rms over the whole ring, we get

$\langle\langle x^2(s)\rangle_E\rangle_s = \sum_i \langle g_i^2(s)\rangle_s\langle\delta_i^2\rangle_E  = \sum_i G_i^2\sigma_{\delta_i}^2$

where $G_i$ is the horizontal orbit amplification factor and $\sigma_{\delta_i}$ is the standard deviation for misalignment errors in the $i$-th element. This formula shows us that all the information needed to determine the orbit of the ring for any ensemble of errors is in the amplification factors of each element.

Analogously, this quadrupole horizontal alignment error also generates optics distortion amplification factors. The fact that the orbit is not null at the sextupoles position introduce new focusing strengths to the optics, leading to a betatron function distortion (betabeating) given by:

$\left(\frac{\Delta \beta}{\beta}\right)_i(s) = \sum_j \frac{x_i(s_j)2 S_j \beta(s_j)\cos2(\phi(s)-\phi(s_j) - \pi\nu)}{2\sin(2\pi\nu)} = \sum_j \frac{g_i(s_j)\delta_i 2S_j \beta(s_j)\cos2(\phi(s)-\phi(s_j) - \pi\nu)}{2\sin(2\pi\nu)} = h_i(s)\delta_i.$

where the index $i$ refers to the position of the quadrupole with the alignment error and the index $j$ to the sextupole position. <xr id="tab:errors_linear_effects" /> shows a relation of each kind of magnet error and its linear effects on the machine, which can be treated using amplification factors. 

|Error| Linear Effect |
| --- | --- |
|Quadrupole Vertical Misalignment| Vertical Orbit, Coupling |
|Quadrupole Horizontal Misalignment| Horizontal Orbit, Betabeating |
|Quadrupole Rotation (Roll)| Coupling |
|Pure Dipole Rotation (Roll)| Vertical Orbit, Coupling |
|Sextupole Horizontal Misalignment| Betabeating |
|Sextupole Vertical Misalignment| Coupling |
|Pure Dipole Excitation| Horizontal Orbit, Betabeating |
|Quadrupole Excitation| Betabeating  |

**Table 1**: Magnet errors and their linear effects on the machine. 

The use of amplification factors does not take into account all the effects of the magnets errors. Thus it does not substitute a complete simulation of the machine with pseudo-random errors to estimate parameters such as momentum or dynamic aperture. However it helps to identify the leading factors and gives a simple way of defining the tolerances of each type of error because all the non-linearities neglected in this treatment are small for well corrected machines, i.e. $|x|(s)<1\text{mm}$.

### Magnet Tolerances

According to the subsection [Amplification Factors](#Amplification Factors), the amplification factor of each error in each magnet depends on the orbit correction system used to counter-act its effect. Thus, for the Sirius storage ring it is possible to define three kinds of amplification factors: without orbit correction (AF w/o COR), with the slow orbit correction system (AF w/ SOFB) and with the fast orbit correction system (AF w/ FOFB); each of them is adequate to study a specific set of errors, depending on their time dependence:

* AF w/ SOFB: for alignment, excitation, or errors due drifts (thermal or floor) or other source which varies slowly with time (less than 0.5Hz);
* AF w/ FOFB: for errors with medium frequency spectrum, such as ripple and low harmonics of power supplies, fundamental modes of girder vibrations (from 0.5Hz to ~200Hz);
* AF w/o COR: for high frequency errors.

#### Slow Frequency Errors

The Alignment and excitation errors are the most detrimental to the dynamic and momentum aperture of the machine, they influence directly the injection efficiency and lifetime. In order to define tolerances for these errors, it would be interesting if each contribution had an equal weight on the properties of the lattice, such as betabeating, residual orbit and coupling, in such a way that the total amount of influences did not limit the dynamic apperture and lifetime of the machine in undesireble levels. Figure 1, Figure 2 and Figure 3 show the residual standard deviation generated by each magnet with the current (2015/02/06) specification of the errors, after slow orbit correction, for the horizontal and vertical orbits, betabeating and angle of the beam (related to coupling) averaged along the whole ring. 


![](/img/groups/fac/Sirius_SR_Amp._Factors_CODx.Mags.SOFB.svg) ![](/img/groups/fac/Sirius_SR_Amp._Factors_CODy.Mags.SOFB.svg)

**Figure 1**: Residual orbit estimated from Amplification Factors with the specified errors after slow orbit correction.

![](/img/groups/fac/Sirius_SR_Amp._Factors_BETx.Mags.SOFB.svg) ![](/img/groups/fac/Sirius_SR_Amp._Factors_BETy.Mags.SOFB.svg)

**Figure 2**: Residual betabeating estimated from Amplification Factors with the specified errors after slow orbit correction.

![](/img/groups/fac/Sirius_SR_Amp._Factors_ANGL.Mags.SOFB.svg)

**Figure 3**: Residual beam angle (coupling) estimated from Amplification Factors with the specified errors after slow orbit correction.

|| CODX| BETAX| BETAY |
| --- | --- | --- | --- |
|quads| 23423| 2423| 234 |
|dips| 23423| 2423| 234 |
|sexts| 23423| 2423| 234  |


||CODX| BETAX| BETAY |
| --- | --- | --- | --- |
|quads| 23423| 2423| 234 |
|dips| 23423| 2423| 234 |
|sexts| 23423| 2423| 234 |


|| CODX| BETAX| BETAY |
| --- | --- | --- | --- |
|quads| 23423| 2423| 234 |
|dips| 23423| 2423| 234 |
|sexts| 23423| 2423| 234  |


|| CODX| BETAX| BETAY |
| --- | --- | --- | --- |
|quads| 23423| 2423| 234 |
|dips| 23423| 2423| 234 |
|sexts| 23423| 2423| 234  


Through the analysis of the figures and the table, the following observations may be taken about the compatibility amongst the error specifications:

* The dominant effects on betabeating and coupling are the sextupoles misalignments which means these errors cannot be relaxed without dynamic aperture simulation;
* The effects of quadrupole misalignment are smaller than the effect of the sextupoles on betabeating and coupling, but are dominant in the residual orbit, thus cannot be relaxed without affect the correctors strengths;
* The roll error of the dipoles can be relaxed, because its effect on coupling is half the one caused by its own vertical misalignment and even smaller for the vertical orbit;
* Even though the roll error of the quadrupoles has approximately the same effect of its vertical misalignment on the coupling, it can be relaxed, because when compared to the sextupole vertical misalignment these effects are negligible;
