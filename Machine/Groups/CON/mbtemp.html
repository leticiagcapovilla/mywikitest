<!--
title: MBTemp
description: 
published: 1
date: 2024-05-28T14:47:18.531Z
tags: 
editor: ckeditor
dateCreated: 2024-05-27T21:20:33.868Z
-->

<h1 class="toc-header" id="con-mbtemp"> CON: MBTemp</h1>
<br>
<h2 class="toc-header" id="introduction"> Introduction</h2>
<p>MBTemp is a module of the <a class="is-internal-link is-valid-page" href="/Machine/control_system">Sirius control system</a> designed to perform measurements from Pt100-based temperature sensors. It is has been completely developed by <a class="is-internal-link is-valid-page" href="/Machine/Groups/CON">Controls Group</a>. This module will be used largely on Sirius Engineering Installation Area to monitor temperature on vacuum chambers, pulsed magnets, access-controlled room and so on. It is intended to have over 8000 points of temperature measurement distributed along accelerators' structure and equipment area.</p>
<br>
<h2 class="toc-header" id="general-description"> General description</h2>
<div class="table-container"><table>
<thead>
<tr>
<th><img alt="" src="/img/groups/con/mbtemp/MBTemp.jpg"></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Figure 1</strong>: MBTemp - Production Unit.</td>
</tr>
</tbody>
</table></div>
<p>Each MBTemp is capable of handling up to 8 Pt100 temperature sensors (2, 3 or 4-wire ones). These sensors are connected to the board through modular connectors (RJ11/4P4C). The analog circuit sources 1 mA to the Pt100 sensor and reads the corresponding voltage drop. After an analog chain for signal conditioning, voltages are sampled by a 16-bit analog-to-digital converter. A PIC microcontroller performs digital integration over the samples of the eight channels, and also handles serial communication (RS-485) at 115200 bps for data sharing.</p>
<p>Application layer protocol for communication to MBTemp boards is <a class="is-asset-link" href="/Machine/Groups/CON/bsmp.md">Basic Small Messages Protocol (BSMP)</a>. Each Pt100 channel is mapped into a <a class="is-asset-link" href="(/Machine/Groups/CON/bsmp.md)">BSMP</a> variable. BSMP variables 0 to 7 are associated to the sensor connected to modular jack 1 to 8. These variables have 2 bytes of size, and must be interpreted as an unsigned integer of 16 bits (big-endian). The temperature measurement (in Celsius degrees) is given by:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>T</mi><mi>e</mi><mi>m</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>e</mi><mo>=</mo><mfrac><mrow><mo stretchy="false">(</mo><mi>B</mi><mi>y</mi><mi>t</mi><mi>e</mi><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo><mo>&lt;</mo><mo>&lt;</mo><mn>8</mn><mo stretchy="false">)</mo><mo>+</mo><mi>B</mi><mi>y</mi><mi>t</mi><mi>e</mi><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><mn>100</mn></mfrac></mrow>Temperature = \frac{(Byte[1] &lt;&lt; 8) + Byte[0]}{100}
</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.8777699999999999em;vertical-align:-0.19444em;" class="strut"></span><span style="margin-right:0.13889em;" class="mord mathnormal">T</span><span class="mord mathnormal">e</span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span><span class="mord mathnormal">e</span><span style="margin-right:0.02778em;" class="mord mathnormal">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">u</span><span style="margin-right:0.02778em;" class="mord mathnormal">r</span><span class="mord mathnormal">e</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span class="mrel">=</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span></span><span class="base"><span style="height:2.113em;vertical-align:-0.686em;" class="strut"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:1.427em;" class="vlist"><span style="top:-2.314em;"><span style="height:3em;" class="pstrut"></span><span class="mord"><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span></span></span><span style="top:-3.23em;"><span style="height:3em;" class="pstrut"></span><span style="border-bottom-width:0.04em;" class="frac-line"></span></span><span style="top:-3.677em;"><span style="height:3em;" class="pstrut"></span><span class="mord"><span class="mopen">(</span><span style="margin-right:0.05017em;" class="mord mathnormal">B</span><span style="margin-right:0.03588em;" class="mord mathnormal">y</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mopen">[</span><span class="mord">1</span><span class="mclose">]</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span class="mrel">&lt;</span><span class="mrel">&lt;</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span class="mord">8</span><span class="mclose">)</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mbin">+</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span style="margin-right:0.05017em;" class="mord mathnormal">B</span><span style="margin-right:0.03588em;" class="mord mathnormal">y</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.686em;" class="vlist"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>For instance, if a <a class="is-asset-link" href="/Machine/Groups/CON/bsmp.md">BSMP</a> variable has a value of 2500, this corresponds to a temperature of 25.00 °C.</p>
<br>
<h2 class="toc-header" id="operation-principle"> Operation principle</h2>
<br>
<h3 class="toc-header" id="pt100-sensors"> Pt100 sensors</h3>
<p>Pt100 is a resistance temperature detector (RTD) made of platinum (Pt) having a resistance of 100 ohms at 0 °C. Basically, it is a resistor whose resistance varies according to its temperature. RTDs are more accurate and stable than thermocouples. The platinum detecting wire must be away from contamination to remain stable and there are plenty of packages available. Commercial detectors have  a temperature coefficient of resistance α  0.00385/°C, what leads to naming them as "Pt100 385".</p>
<p>The relation between temperature and resistance is given by the Callendar-Van Dusen equation, for positive temperatures:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>R</mi><mi>T</mi></msub><mo>=</mo><msub><mi>R</mi><mn>0</mn></msub><mrow><mo fence="true">[</mo><mn>1</mn><mo>+</mo><mi>A</mi><mi>T</mi><mo>+</mo><mi>B</mi><msup><mi>T</mi><mn>2</mn></msup><mo fence="true">]</mo></mrow><mtext>  </mtext><mo stretchy="false">(</mo><mn>0</mn><mtext>  </mtext><msup><mrow></mrow><mo rspace="0em" lspace="0em">∘</mo></msup><mi mathvariant="normal">C</mi><mo>≤</mo><mi>T</mi><mo>&lt;</mo><mn>850</mn><mtext>  </mtext><msup><mrow></mrow><mo rspace="0em" lspace="0em">∘</mo></msup><mi mathvariant="normal">C</mi><mo stretchy="false">)</mo></mrow>R_T = R_0 \left[ 1 + AT + BT^2 \right] \; (0\;{}^{\circ}\mathrm{C} \leq T &lt; 850\;{}^{\circ}\mathrm{C})
</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.83333em;vertical-align:-0.15em;" class="strut"></span><span class="mord"><span style="margin-right:0.00773em;" class="mord mathnormal">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.32833099999999993em;" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span style="height:2.7em;" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right:0.13889em;" class="mord mathnormal mtight">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em;" class="vlist"><span></span></span></span></span></span></span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span class="mrel">=</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span></span><span class="base"><span style="height:1.2141179999999998em;vertical-align:-0.35001em;" class="strut"></span><span class="mord"><span style="margin-right:0.00773em;" class="mord mathnormal">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.30110799999999993em;" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span style="height:2.7em;" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em;" class="vlist"><span></span></span></span></span></span></span><span style="margin-right:0.16666666666666666em;" class="mspace"></span><span class="minner"><span style="top:0em;" class="mopen delimcenter"><span class="delimsizing size1">[</span></span><span class="mord">1</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mbin">+</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mord mathnormal">A</span><span style="margin-right:0.13889em;" class="mord mathnormal">T</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mbin">+</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span style="margin-right:0.05017em;" class="mord mathnormal">B</span><span class="mord"><span style="margin-right:0.13889em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span style="height:0.8641079999999999em;" class="vlist"><span style="top:-3.113em;margin-right:0.05em;"><span style="height:2.7em;" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span style="top:0em;" class="mclose delimcenter"><span class="delimsizing size1">]</span></span></span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span style="margin-right:0.16666666666666666em;" class="mspace"></span><span class="mopen">(</span><span class="mord">0</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span class="mord"><span class="mord"></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span style="height:0.724115em;" class="vlist"><span style="top:-3.113em;margin-right:0.05em;"><span style="height:2.7em;" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∘</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathrm">C</span></span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span class="mrel">≤</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span></span><span class="base"><span style="height:0.72243em;vertical-align:-0.0391em;" class="strut"></span><span style="margin-right:0.13889em;" class="mord mathnormal">T</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span class="mrel">&lt;</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span></span><span class="base"><span style="height:1em;vertical-align:-0.25em;" class="strut"></span><span class="mord">8</span><span class="mord">5</span><span class="mord">0</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span class="mord"><span class="mord"></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span style="height:0.724115em;" class="vlist"><span style="top:-3.113em;margin-right:0.05em;"><span style="height:2.7em;" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∘</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathrm">C</span></span><span class="mclose">)</span></span></span></span></span></p><p>Here <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>R</mi><mi>T</mi></msub></mrow>R_T</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.83333em;vertical-align:-0.15em;" class="strut"></span><span class="mord"><span style="margin-right:0.00773em;" class="mord mathnormal">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.32833099999999993em;" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span style="height:2.7em;" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right:0.13889em;" class="mord mathnormal mtight">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em;" class="vlist"><span></span></span></span></span></span></span></span></span></span> is the resistance at temperature <em>T</em>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>R</mi><mn>0</mn></msub></mrow>R_0</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.83333em;vertical-align:-0.15em;" class="strut"></span><span class="mord"><span style="margin-right:0.00773em;" class="mord mathnormal">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.30110799999999993em;" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span style="height:2.7em;" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em;" class="vlist"><span></span></span></span></span></span></span></span></span></span> is the resistance at 0 °C.</p>
<p>the constants for a Pt100 385 are:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>A</mi><mo>=</mo><mn>3.9083</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mrow><mo>−</mo><mn>3</mn></mrow></msup><msup><mtext>&nbsp;</mtext><mo>∘</mo></msup><msup><mtext>C</mtext><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow>A =  3.9083 \times 10^{-3}~^\circ\text{C}^{-1}
</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em;" class="strut"></span><span class="mord mathnormal">A</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span class="mrel">=</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span></span><span class="base"><span style="height:0.72777em;vertical-align:-0.08333em;" class="strut"></span><span class="mord">3</span><span class="mord">.</span><span class="mord">9</span><span class="mord">0</span><span class="mord">8</span><span class="mord">3</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mbin">×</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span></span><span class="base"><span style="height:0.887338em;vertical-align:0em;" class="strut"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span style="height:0.864108em;" class="vlist"><span style="top:-3.113em;margin-right:0.05em;"><span style="height:2.7em;" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">3</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mspace nobreak">&nbsp;</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span style="height:0.724115em;" class="vlist"><span style="top:-3.113em;margin-right:0.05em;"><span style="height:2.7em;" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∘</span></span></span></span></span></span></span></span><span class="mord"><span class="mord text"><span class="mord">C</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span style="height:0.887338em;" class="vlist"><span style="top:-3.1362300000000003em;margin-right:0.05em;"><span style="height:2.7em;" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>B</mi><mo>=</mo><mo>−</mo><mn>5.775</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mrow><mo>−</mo><mn>7</mn></mrow></msup><msup><mtext>&nbsp;</mtext><mo>∘</mo></msup><msup><mtext>C</mtext><mrow><mo>−</mo><mn>2</mn></mrow></msup></mrow>B = -5.775 \times 10^{-7}~^\circ\text{C}^{-2}
</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em;" class="strut"></span><span style="margin-right:0.05017em;" class="mord mathnormal">B</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span class="mrel">=</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span></span><span class="base"><span style="height:0.72777em;vertical-align:-0.08333em;" class="strut"></span><span class="mord">−</span><span class="mord">5</span><span class="mord">.</span><span class="mord">7</span><span class="mord">7</span><span class="mord">5</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mbin">×</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span></span><span class="base"><span style="height:0.887338em;vertical-align:0em;" class="strut"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span style="height:0.864108em;" class="vlist"><span style="top:-3.113em;margin-right:0.05em;"><span style="height:2.7em;" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">7</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mspace nobreak">&nbsp;</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span style="height:0.724115em;" class="vlist"><span style="top:-3.113em;margin-right:0.05em;"><span style="height:2.7em;" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∘</span></span></span></span></span></span></span></span><span class="mord"><span class="mord text"><span class="mord">C</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span style="height:0.887338em;" class="vlist"><span style="top:-3.1362300000000003em;margin-right:0.05em;"><span style="height:2.7em;" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span></p><p>The solution of the quadratic equation yields the following relationship between temperature and resistance:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>T</mi><mo>=</mo><mfrac><mrow><mo>−</mo><mi>A</mi><mo>+</mo><msqrt><mrow><msup><mi>A</mi><mn>2</mn></msup><mo>−</mo><mn>4</mn><mi>B</mi><mrow><mo fence="true">(</mo><mn>1</mn><mo>−</mo><mfrac><msub><mi>R</mi><mi>T</mi></msub><msub><mi>R</mi><mn>0</mn></msub></mfrac><mo fence="true">)</mo></mrow></mrow></msqrt></mrow><mrow><mn>2</mn><mi>B</mi></mrow></mfrac></mrow>T = \frac{-A + \sqrt{A^2 - 4B\left(1 - \frac{R_T}{R_0}\right)}}{2B}
</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em;" class="strut"></span><span style="margin-right:0.13889em;" class="mord mathnormal">T</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span class="mrel">=</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span></span><span class="base"><span style="height:3.516em;vertical-align:-0.686em;" class="strut"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:2.83em;" class="vlist"><span style="top:-2.8489899999999997em;"><span style="height:3.5349899999999996em;" class="pstrut"></span><span class="mord"><span class="mord">2</span><span style="margin-right:0.05017em;" class="mord mathnormal">B</span></span></span><span style="top:-3.7649899999999996em;"><span style="height:3.5349899999999996em;" class="pstrut"></span><span style="border-bottom-width:0.04em;" class="frac-line"></span></span><span style="top:-4.83em;"><span style="height:3.5349899999999996em;" class="pstrut"></span><span class="mord"><span class="mord">−</span><span class="mord mathnormal">A</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mbin">+</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:1.5349899999999996em;" class="vlist"><span style="top:-4.4em;" class="svg-align"><span style="height:4.4em;" class="pstrut"></span><span style="padding-left:1em;" class="mord"><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span style="height:0.740108em;" class="vlist"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span style="height:2.7em;" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mbin">−</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mord">4</span><span style="margin-right:0.05017em;" class="mord mathnormal">B</span><span style="margin-right:0.16666666666666666em;" class="mspace"></span><span class="minner"><span style="top:0em;" class="mopen delimcenter"><span class="delimsizing size2">(</span></span><span class="mord">1</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mbin">−</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.8886359999999999em;" class="vlist"><span style="top:-2.655em;"><span style="height:3em;" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span style="margin-right:0.00773em;" class="mord mathnormal mtight">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.31731428571428577em;" class="vlist"><span style="top:-2.357em;margin-left:-0.00773em;margin-right:0.07142857142857144em;"><span style="height:2.5em;" class="pstrut"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.143em;" class="vlist"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span style="height:3em;" class="pstrut"></span><span style="border-bottom-width:0.04em;" class="frac-line"></span></span><span style="top:-3.410305em;"><span style="height:3em;" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span style="margin-right:0.00773em;" class="mord mathnormal mtight">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.3448em;" class="vlist"><span style="top:-2.3567071428571427em;margin-left:-0.00773em;margin-right:0.07142857142857144em;"><span style="height:2.5em;" class="pstrut"></span><span class="sizing reset-size3 size1 mtight"><span style="margin-right:0.13889em;" class="mord mathnormal mtight">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.14329285714285717em;" class="vlist"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.44509999999999994em;" class="vlist"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span style="top:0em;" class="mclose delimcenter"><span class="delimsizing size2">)</span></span></span></span></span><span style="top:-3.49499em;"><span style="height:4.4em;" class="pstrut"></span><span style="min-width:1.02em;height:2.48em;" class="hide-tail"><svg preserveAspectRatio="xMinYMin slice" viewBox="0 0 400000 2592" height="2.48em" width="400em"><path d="M424,2478
c-1.3,-0.7,-38.5,-172,-111.5,-514c-73,-342,-109.8,-513.3,-110.5,-514
c0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,25c-5.7,9.3,-9.8,16,-12.5,20
s-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,-13s76,-122,76,-122s77,-121,77,-121
s209,968,209,968c0,-2,84.7,-361.7,254,-1079c169.3,-717.3,254.7,-1077.7,256,-1081
l0 -0c4,-6.7,10,-10,18,-10 H400000
v40H1014.6
s-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185
c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2z M1001 80
h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.9050100000000003em;" class="vlist"><span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.686em;" class="vlist"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>Since <em>B</em> is relatively small, the resistance changes <em>almost</em> linearly with the temperature. Considering that most applications will be around environment temperature, a linear fit is acceptable and is what will be done by Controls Group at first.</p>
<br>
<h3 class="toc-header" id="measuring-the-resistance"> Measuring the resistance</h3>
<p>Once Pt100 is a passive temperature sensor, it is needed to have a circuitry in order to have its value. 4-wire Pt100 sensors are recommended the most and its measurement can be seen in the following image:</p>
<div class="table-container"><table>
<thead>
<tr>
<th><img alt="" src="/img/groups/con/mbtemp/Sch_pt100.png"></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Figure 2</strong>:</td>
</tr>
</tbody>
</table></div>
<p>One pair is used for current injection. Having a constant current flowing through a resistance, a voltage drop is generated. The other pair collects the voltage over the Pt100 resistor and makes it available for measurements or conditioning electronics. Having two pair of cables makes the measurement more reliable, once cable resistance (ie, length/section/etc) is not taken into account.</p>
<p>It is important to assure that dissipated power due to the current flowing through Pt100 sensor, which is a resistance, does not heat the sensor itself, otherwise the final value may not correspond to the real environment.</p>
<p>3-wire and 2-wire Pt100 can also be read using the same method. However, final values may not be equal within these three Pt100 types due to cable resistance interference.</p>
<br>
<h3 class="toc-header" id="digital-filter"> Digital filter</h3>
<p>As an overview in this application, implementing a digital filter eliminates noise during measurements. Temperature gradient is low and data acquisition does not need to be fast. It has been chosen to filter the values digitally using the exponential moving average law:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>T</mi><mi>e</mi><mi>m</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>e</mi><mi>A</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>g</mi><mi>e</mi><mo>=</mo><mfrac><mrow><mi>O</mi><mi>l</mi><mi>d</mi><mi>T</mi><mi>e</mi><mi>m</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>e</mi><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>∗</mo><mi>α</mi><mo>+</mo><mi>N</mi><mi>e</mi><mi>w</mi><mi>T</mi><mi>e</mi><mi>m</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>e</mi><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>∗</mo><mo stretchy="false">(</mo><mn>1000</mn><mo>−</mo><mi>α</mi><mo stretchy="false">)</mo></mrow><mn>1000</mn></mfrac><mtext>  </mtext><mtext>  </mtext><mo stretchy="false">(</mo><mn>0</mn><mtext>  </mtext><mo>≤</mo><mi>α</mi><mo>&lt;</mo><mn>1000</mn><mo stretchy="false">)</mo></mrow>Temperature Average = \frac{OldTemperatureValue*\alpha + NewTemperatureValue*(1000 - \alpha)}{1000}  \;\; (0\; \leq \alpha &lt; 1000)
</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.8777699999999999em;vertical-align:-0.19444em;" class="strut"></span><span style="margin-right:0.13889em;" class="mord mathnormal">T</span><span class="mord mathnormal">e</span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span><span class="mord mathnormal">e</span><span style="margin-right:0.02778em;" class="mord mathnormal">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">u</span><span style="margin-right:0.02778em;" class="mord mathnormal">r</span><span class="mord mathnormal">e</span><span class="mord mathnormal">A</span><span style="margin-right:0.03588em;" class="mord mathnormal">v</span><span class="mord mathnormal">e</span><span style="margin-right:0.02778em;" class="mord mathnormal">r</span><span class="mord mathnormal">a</span><span style="margin-right:0.03588em;" class="mord mathnormal">g</span><span class="mord mathnormal">e</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span class="mrel">=</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span></span><span class="base"><span style="height:2.113em;vertical-align:-0.686em;" class="strut"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:1.427em;" class="vlist"><span style="top:-2.314em;"><span style="height:3em;" class="pstrut"></span><span class="mord"><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span></span></span><span style="top:-3.23em;"><span style="height:3em;" class="pstrut"></span><span style="border-bottom-width:0.04em;" class="frac-line"></span></span><span style="top:-3.677em;"><span style="height:3em;" class="pstrut"></span><span class="mord"><span style="margin-right:0.02778em;" class="mord mathnormal">O</span><span style="margin-right:0.01968em;" class="mord mathnormal">l</span><span class="mord mathnormal">d</span><span style="margin-right:0.13889em;" class="mord mathnormal">T</span><span class="mord mathnormal">e</span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span><span class="mord mathnormal">e</span><span style="margin-right:0.02778em;" class="mord mathnormal">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">u</span><span style="margin-right:0.02778em;" class="mord mathnormal">r</span><span class="mord mathnormal">e</span><span style="margin-right:0.22222em;" class="mord mathnormal">V</span><span class="mord mathnormal">a</span><span style="margin-right:0.01968em;" class="mord mathnormal">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mbin">∗</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span style="margin-right:0.0037em;" class="mord mathnormal">α</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mbin">+</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span style="margin-right:0.10903em;" class="mord mathnormal">N</span><span class="mord mathnormal">e</span><span style="margin-right:0.02691em;" class="mord mathnormal">w</span><span style="margin-right:0.13889em;" class="mord mathnormal">T</span><span class="mord mathnormal">e</span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span><span class="mord mathnormal">e</span><span style="margin-right:0.02778em;" class="mord mathnormal">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">u</span><span style="margin-right:0.02778em;" class="mord mathnormal">r</span><span class="mord mathnormal">e</span><span style="margin-right:0.22222em;" class="mord mathnormal">V</span><span class="mord mathnormal">a</span><span style="margin-right:0.01968em;" class="mord mathnormal">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mbin">∗</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mbin">−</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span style="margin-right:0.0037em;" class="mord mathnormal">α</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.686em;" class="vlist"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span class="mopen">(</span><span class="mord">0</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span class="mrel">≤</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span></span><span class="base"><span style="height:0.5782em;vertical-align:-0.0391em;" class="strut"></span><span style="margin-right:0.0037em;" class="mord mathnormal">α</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span class="mrel">&lt;</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span></span><span class="base"><span style="height:1em;vertical-align:-0.25em;" class="strut"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mclose">)</span></span></span></span></span></p><p>Alpha factor is user-defined and must be an integer in the range 0 - 999.<br>
For MBTemp application, there will be some exceptions for this filter (explained on firmware section).</p>
<br>
<h2 class="toc-header" id="hardware-details"> Hardware details</h2>
<br>
<h3 class="toc-header" id="overview"> Overview</h3>
<p>The latest MBTemp hardware version, 2.6, was manufactured in 2018 and are currently in use at Sirius installations. This is an Eurocard-size board with a stack, dedicated for Pt100 input connectors routing.</p>
<p>It can interface to up to 8 channels. There is only one current generator, one analog conditional circuitry, one one-channel analog-to-digital converter. It means that channels are multiplexed and read sequentially.</p>
<div class="table-container"><table>
<thead>
<tr>
<th><img alt="" src="/img/groups/con/mbtemp/Mbtemp-up.png"></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Figure 3</strong>:</td>
</tr>
</tbody>
</table></div>
<p>[[[ FOTO DO PAINEL FRONTAL + TRASEIRO ]]]</p>
<br>
<h3 class="toc-header" id="power-input-and-filters"> Power input and filters</h3>
<p>In order to power the board and have it completely functional, connect the front jack with a reliable +5V/2A power source (positive center). Controls Group recommends CUI Inc. power supply brand.</p>
<p>Typical power consumption: <strong>1.5 W</strong></p>
<p>It is possible to power the board with higher voltages. <strong>Caution: it needs a simple hardware modification on the board!</strong></p>
<br>
<h3 class="toc-header" id="pt100-input-connectors"> Pt100 input connectors</h3>
<div class="table-container"><table>
<thead>
<tr>
<th><img alt="" src="/img/groups/con/mbtemp/4p4c.png"></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Figure 4</strong>:</td>
</tr>
</tbody>
</table></div>
<div class="table-container"><table>
<thead>
<tr>
<th><img alt="" src="/img/groups/con/mbtemp/Pt100-layout.png"></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Figure 5</strong>:</td>
</tr>
</tbody>
</table></div>
<p>Modular RJ-11 (4P4C) connector has been chosen for Pt100 connectivity. Pins 1 and 2 will be connected to a Pt100 side and pins 3 and 4 will be connected to the other side. Current flow from I to GND and V+/V- is differential voltage on the sensor resistance.</p>
<p>MBTemp signals:</p>
<p><strong>1.</strong> I (1 mA)</p>
<p><strong>2.</strong> V+</p>
<p><strong>3.</strong> GND</p>
<p><strong>4.</strong> V-</p>
<br>
<h3 class="toc-header" id="pic-microcontroller"> PIC microcontroller</h3>
<p>A 16F-family PIC microcontroller (16F887A) is the core of the system. It is responsible for communication routine, data acquisition, coefficient storage and calculations. The code itself was written in C, compiled using MPLAB IDE (free version). More details about programming logic is described in the <a class="is-internal-link is-invalid-page" href="/Machine/Groups/CON/mbtemp/link">CON:MBTemp#Firmware_details|specific section</a>.</p>
<br>
<h3 class="toc-header" id="power-converters-for-conditioning-circuitry"> Power converters for conditioning circuitry</h3>
<p>An important stage for temperature data acquisition is the power converters for the conditioning circuitry. Some devices need symetric power supply or even a power supply greater than 5V for drop-out compensation. For that purpose, this piece of hardware converts and provides +6V and -5V for analog ICs.</p>
<br>
<h3 class="toc-header" id="analog-multiplexing"> Analog multiplexing</h3>
<p>For system optimization, there is only one channel for data acquisition. Once 8 channels are available, a set of multiplexing switches were added to the board, allowing each signal to be read sequentially. Current source is multiplexed as well, what is also interesting because it reduces power dissipation over a Pt100, reducing external interference.</p>
<p>Those switches are digitally controlled by the same microcontroller responsible for digital data acquisition.</p>
<div class="table-container"><table>
<thead>
<tr>
<th><img alt="" src="/img/machine/rf_system/CESR_cavity_SRF_module.png"></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Figure 6</strong>: Cut view of the CESR cavity SRF module.</td>
</tr>
</tbody>
</table></div>
<br>
<h3 class="toc-header" id="conditioning-circuitry-and-adc"> Conditioning circuitry and ADC</h3>
<p>It is mandatory to have a conditioning circuitry for temperature data acquisition. As Pt100 sensors have low resistance and a low current flows, the voltage drop is relatively small and needs a gain and offset to be acquired by the ADC. Instrumentation ICs are  used as well as high precision voltage references and resistors. Digital result is read through SPI interface.</p>
<br>
<h3 class="toc-header" id="serial-communication-rs-485"> Serial communication (RS-485)</h3>
<p>For serial communication, the standard chosen by Controls Group is also adopted (described <a class="is-internal-link is-invalid-page" href="/Machine/Groups/CON/mbtemp/link">CON:SERIALxxCON|here</a>).</p>
<ul>
<li><strong>Connector and Pinout</strong><br>
A 6P6C (RJ-12/RJ-25) has been chosen for Controls system as well as its pinout, as shown below. MBTemps also follow this standard.</li>
</ul>
<div class="table-container"><table>
<thead>
<tr>
<th><img alt="" src="/img/groups/con/mbtemp/6P6C_ConnectorPinout_RS485.png"></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Figure 7</strong>:</td>
</tr>
</tbody>
</table></div>
<ul>
<li><strong>Termination</strong><br>
Termination is needed <em><strong>only in the last device connected to the multi-drop serial network</strong></em> in order to match serial transmission line. It can be activated by pulling the correspondent front panel switch on. RS-485 impedance is 120Ω.</li>
</ul>
<br>
<h3 class="toc-header" id="board-id-and-module-address"> Board ID and module address</h3>
<p>Board ID in a unique ID that the board has received after being manufactured.</p>
<p>On the other hand, the module address is specific for communication purpose. As it is a BSMP slave device, it will only reply commands that match their pre-configured address. It is configured through the 5-position switch front panel, binary coded. Valid value: 1 to 31.</p>
<p><strong>Attention</strong>: once the module address is modified, it is mandatory to reboot the board!</p>
<br>
<h3 class="toc-header" id="production-units"> Production units</h3>
<p>400 units have been manufactured in early 2018. They have been installed on Sirius site in several environments (tunnel, power area, RF room, instrumentation area, etc.).</p>
<br>
<h3 class="toc-header" id="more-technical-documentation"> More technical documentation</h3>
<p>Detailed documents can be found at project repository at CNPEM gitlab (<a class="is-external-link" href="http://gitlab.cnpem.br/patricia.nallin/mbtemp">click here</a>, you must be connected through CNPEM network).</p>
<br>
<h3 class="toc-header" id="hardware-versions"> Hardware versions</h3>
<p>Eurocard sized:</p>
<ul>
<li><strong>v2.6 (latest)</strong></li>
<li>v2.5</li>
</ul>
<br>
<h2 class="toc-header" id="firmware-details"> Firmware details</h2>
<br>
<h3 class="toc-header" id="brief-description"> Brief description</h3>
<p>Firmware running on PIC microcontrollers has one single process. Initially, it gets the board module ID from switches on the front panel, it gets all static variables (stored in its EEPROM memory): alpha, linear and angular coefficients. Also, it configures a DCDC converter in the board (which is currently not in use) and configures the modules that will be used (I2C, SPI, UART, interruption).</p>
<ul>
<li>SPI: used for getting data from ADC;</li>
<li>I2C: communication with DC/DC converter;</li>
<li>UART: serial interface RS-485;</li>
<li>Interruption: treating incoming serial data and replying to it (if necessary).</li>
</ul>
<p>After that, a continuous loop begins, which reads all eight channels sequentially.</p>
<br>
<h3 class="toc-header" id="serial-communication"> Serial communication</h3>
<p>Communication through <a class="is-internal-link is-invalid-page" href="/Machine/Groups/CON/mbtemp/link">[CON:MBTemp#BSMP_entities|BSMP protocol and entities]</a>. You can have more information about variables in next section and about <a class="is-internal-link is-valid-page" href="/Machine/Groups/CON/bsmp">BSMP protocol</a> in a dedicated page.</p>
<p>Serial communication physical layer is based on RS-485, using the pattern predefined by Controls Group, as shown above.</p>
<p>Once a character is received by the board, it enables an interruption signal which will interrupt the continuous loop and treat the incoming message. If the board is the destination, it will reply to the message and go back to reading Pt100 sensors.</p>
<br>
<h3 class="toc-header" id="calibration-linear-fit"> Calibration - Linear fit</h3>
<p>MBTemps perform the reading of analog values, which are amplified to a larger and readable signal. Yet, even though specific componentes are used, they may add errors to the final output value. In general, for those purposes, it is needed to calibrate each single system, in order to guarantee correct and reliable readings for all channels.</p>
<p>As seen above, Pt100 temperature-resistance equation is a second-order one. Chosen microcontroller is not able to perform this operations and thus, a linear fit may apply. Almost all applications will be measuring temperatures near environment temperature, so a linear fit around 25 °C does not add elevated errors to final results:</p>
<div class="table-container"><table>
<thead>
<tr>
<th><img alt="" src="/img/groups/con/mbtemp/Pt100-curves.png"></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Figure 8</strong>:</td>
</tr>
</tbody>
</table></div>
<p>So, for a linear fit, it is needed to acquire the values from two different temperature points, at least. Controls Group, while calibrating the boards, takes 3 different points (usually 20, 25 and 30 °C) and 30 samples for each value. It is important to note that, for calibration and temperature reading, it is not needed to calculate what is the Pt100 current resistance. Having the ADC value is enough for calibrating and readings:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>R</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>T</mi><mi>e</mi><mi>m</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>e</mi><mo>=</mo><mfrac><mrow><mi>A</mi><mi>D</mi><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi></mrow><mi>k</mi></mfrac><mo>−</mo><mi>b</mi></mrow>Read Temperature = \frac{ADvalue}{k} - b
</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.8888799999999999em;vertical-align:-0.19444em;" class="strut"></span><span style="margin-right:0.00773em;" class="mord mathnormal">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal">d</span><span style="margin-right:0.13889em;" class="mord mathnormal">T</span><span class="mord mathnormal">e</span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span><span class="mord mathnormal">e</span><span style="margin-right:0.02778em;" class="mord mathnormal">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">u</span><span style="margin-right:0.02778em;" class="mord mathnormal">r</span><span class="mord mathnormal">e</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span class="mrel">=</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span></span><span class="base"><span style="height:2.05744em;vertical-align:-0.686em;" class="strut"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:1.37144em;" class="vlist"><span style="top:-2.314em;"><span style="height:3em;" class="pstrut"></span><span class="mord"><span style="margin-right:0.03148em;" class="mord mathnormal">k</span></span></span><span style="top:-3.23em;"><span style="height:3em;" class="pstrut"></span><span style="border-bottom-width:0.04em;" class="frac-line"></span></span><span style="top:-3.677em;"><span style="height:3em;" class="pstrut"></span><span class="mord"><span class="mord mathnormal">A</span><span style="margin-right:0.02778em;" class="mord mathnormal">D</span><span style="margin-right:0.03588em;" class="mord mathnormal">v</span><span class="mord mathnormal">a</span><span style="margin-right:0.01968em;" class="mord mathnormal">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.686em;" class="vlist"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mbin">−</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span></span><span class="base"><span style="height:0.69444em;vertical-align:0em;" class="strut"></span><span class="mord mathnormal">b</span></span></span></span></span></p><p>After calibration, <strong>k ≈ 48</strong> and <strong>b ≈ 258</strong>. They are unique for each piece of hardware.</p>
<p><em><strong>INTERESTING NOTE: RECOVERING FROM LINEAR FIT TO REAL VALUE IS POSSIBLE IN HIGH LEVEL SYSTEMS AND IT IS DONE IN CONTROLS IOCS.</strong></em></p>
<br>
<h3 class="toc-header" id="temperature-measurements"> Temperature measurements</h3>
<div class="table-container"><table>
<thead>
<tr>
<th><img alt="" src="/img/groups/con/mbtemp/Mbtemp-reading-flow.png"></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Figure 9</strong>:</td>
</tr>
</tbody>
</table></div>
<p>Sequential readings are done according to the flow chart above. Double ADC reading, with and without current, is performed to eliminate (or highly decrease) interference due to power network (60Hz, in Brazil).<br>
Also, if a temperature value is greater than 1 °C compared to last value, a new reading cycle is performed to assure this new measurement is valid.</p>
<p>Range: 0 °C to ~395 °C from board (linear fit)    |    0 °C to ~420 °C from high level system (quadratic equation)</p>
<br>
<h2 class="toc-header" id="bsmp-entities"> BSMP entities</h2>
<p>Once MBTemp communication protocol is based on BSMP, data acquisition and variable handling is done using its entities, which are all variables.</p>
<p>{| class="wikitable" style="text-align: center;"<br>
|-<br>
! ID !! Variable !! Access !! Size (bytes) !! Group ID<br>
|-<br>
| 0 || Channel 0 (Input 1) || rowspan="8" | R || rowspan="8" |2 || rowspan="8" | 0 and 1<br>
|-<br>
| 1 || Channel 1 (Input 2)<br>
|-<br>
| 2 || Channel 2 (Input 3)<br>
|-<br>
| 3 || Channel 3 (Input 4)<br>
|-<br>
| 4 || Channel 4 (Input 5)<br>
|-<br>
| 5 || Channel 5 (Input 6)<br>
|-<br>
| 6 || Channel 6 (Input 7)<br>
|-<br>
| 7 || Channel 7 (Input 8)<br>
|-<br>
| 8 || Alpha 1 (a1)|| rowspan="11" | R/W || rowspan="3" | 2 || rowspan="11" | 0 and 2<br>
|-<br>
| 9 || Angular coefficient 1 (k1)<br>
|-<br>
| 10 || Linear coefficient 1 (b1)<br>
|-<br>
| 11 || AD Reading Mode || rowspan="2" | 1<br>
|-<br>
| 12 || Reading Mode<br>
|-<br>
| 13 || Alpha 2 (a2)|| rowspan="6" | 2<br>
|-<br>
| 14 || Angular coefficient 2 (k2)<br>
|-<br>
| 15 || Linear coefficient 2 (b2)<br>
|-<br>
| 16 || Alpha 3 (a3)<br>
|-<br>
| 17 || Angular coefficient 3 (k3)<br>
|-<br>
| 18 || Linear coefficient 3 (b3)<br>
|}</p>
<br>
<h3 class="toc-header" id="variable-temperature-channels-id-0-7"> Variable: Temperature (Channels ID 0 -7)</h3>
<p>ID: 0 - 7     Size: 2 bytes [Byte1|Byte0]     Read-only</p>
<p>Acquired temperature according to each channel. To get its value:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>T</mi><mi>e</mi><mi>m</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>e</mi><mo>=</mo><mfrac><mrow><mo stretchy="false">(</mo><mi>B</mi><mi>y</mi><mi>t</mi><mi>e</mi><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo><mo>&lt;</mo><mo>&lt;</mo><mn>8</mn><mo stretchy="false">)</mo><mo>+</mo><mi>B</mi><mi>y</mi><mi>t</mi><mi>e</mi><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><mn>100</mn></mfrac></mrow>Temperature = \frac{(Byte[1] &lt;&lt; 8) + Byte[0]}{100}
</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.8777699999999999em;vertical-align:-0.19444em;" class="strut"></span><span style="margin-right:0.13889em;" class="mord mathnormal">T</span><span class="mord mathnormal">e</span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span><span class="mord mathnormal">e</span><span style="margin-right:0.02778em;" class="mord mathnormal">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">u</span><span style="margin-right:0.02778em;" class="mord mathnormal">r</span><span class="mord mathnormal">e</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span class="mrel">=</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span></span><span class="base"><span style="height:2.113em;vertical-align:-0.686em;" class="strut"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:1.427em;" class="vlist"><span style="top:-2.314em;"><span style="height:3em;" class="pstrut"></span><span class="mord"><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span></span></span><span style="top:-3.23em;"><span style="height:3em;" class="pstrut"></span><span style="border-bottom-width:0.04em;" class="frac-line"></span></span><span style="top:-3.677em;"><span style="height:3em;" class="pstrut"></span><span class="mord"><span class="mopen">(</span><span style="margin-right:0.05017em;" class="mord mathnormal">B</span><span style="margin-right:0.03588em;" class="mord mathnormal">y</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mopen">[</span><span class="mord">1</span><span class="mclose">]</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span class="mrel">&lt;</span><span class="mrel">&lt;</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span class="mord">8</span><span class="mclose">)</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mbin">+</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span style="margin-right:0.05017em;" class="mord mathnormal">B</span><span style="margin-right:0.03588em;" class="mord mathnormal">y</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.686em;" class="vlist"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><br>
<h3 class="toc-header" id="variable-alpha-ids-8-13-and-16"> Variable: Alpha (IDs 8, 13 and 16)</h3>
<p>ID: 8, 13 and 16     Size: 2 bytes [Byte1|Byte0]     Read/Write</p>
<p>Moving average factor for temperature reading (performed on board). It must be in the range 0-999.</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>α</mi><mo>=</mo><mo stretchy="false">(</mo><mi>B</mi><mi>y</mi><mi>t</mi><mi>e</mi><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo><mo>&lt;</mo><mo>&lt;</mo><mn>8</mn><mo stretchy="false">)</mo><mo>+</mo><mi>B</mi><mi>y</mi><mi>t</mi><mi>e</mi><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo></mrow>\alpha = (Byte[1] &lt;&lt; 8) + Byte[0]
</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.43056em;vertical-align:0em;" class="strut"></span><span style="margin-right:0.0037em;" class="mord mathnormal">α</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span class="mrel">=</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span></span><span class="base"><span style="height:1em;vertical-align:-0.25em;" class="strut"></span><span class="mopen">(</span><span style="margin-right:0.05017em;" class="mord mathnormal">B</span><span style="margin-right:0.03588em;" class="mord mathnormal">y</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mopen">[</span><span class="mord">1</span><span class="mclose">]</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span class="mrel">&lt;</span></span><span class="base"><span style="height:0.5782em;vertical-align:-0.0391em;" class="strut"></span><span class="mrel">&lt;</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span></span><span class="base"><span style="height:1em;vertical-align:-0.25em;" class="strut"></span><span class="mord">8</span><span class="mclose">)</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mbin">+</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span></span><span class="base"><span style="height:1em;vertical-align:-0.25em;" class="strut"></span><span style="margin-right:0.05017em;" class="mord mathnormal">B</span><span style="margin-right:0.03588em;" class="mord mathnormal">y</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span></span></span></span></span></p><p>Variables are stored three times in order to guarantee data consistency after system start up.<br>
Any change on any variable (ID 8, 13 or 16) will change others as well (ID 8, 13 and 16), once they refer to the same constant.</p>
<br>
<h3 class="toc-header" id="variable-angular-coefficient-ids-9-14-and-17"> Variable: Angular coefficient (IDs 9, 14 and 17)</h3>
<p>ID: 9, 14 and 17     Size: 2 bytes [Byte1|Byte0]     Read/Write</p>
<p>Angular coefficient for temperature calculation according to ADC value.</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>k</mi><mo>=</mo><mfrac><mrow><mo stretchy="false">(</mo><mi>B</mi><mi>y</mi><mi>t</mi><mi>e</mi><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo><mo>&lt;</mo><mo>&lt;</mo><mn>8</mn><mo stretchy="false">)</mo><mo>+</mo><mi>B</mi><mi>y</mi><mi>t</mi><mi>e</mi><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><mn>100</mn></mfrac></mrow>k = \frac{(Byte[1] &lt;&lt; 8) + Byte[0]}{100}
</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.69444em;vertical-align:0em;" class="strut"></span><span style="margin-right:0.03148em;" class="mord mathnormal">k</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span class="mrel">=</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span></span><span class="base"><span style="height:2.113em;vertical-align:-0.686em;" class="strut"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:1.427em;" class="vlist"><span style="top:-2.314em;"><span style="height:3em;" class="pstrut"></span><span class="mord"><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span></span></span><span style="top:-3.23em;"><span style="height:3em;" class="pstrut"></span><span style="border-bottom-width:0.04em;" class="frac-line"></span></span><span style="top:-3.677em;"><span style="height:3em;" class="pstrut"></span><span class="mord"><span class="mopen">(</span><span style="margin-right:0.05017em;" class="mord mathnormal">B</span><span style="margin-right:0.03588em;" class="mord mathnormal">y</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mopen">[</span><span class="mord">1</span><span class="mclose">]</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span class="mrel">&lt;</span><span class="mrel">&lt;</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span class="mord">8</span><span class="mclose">)</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mbin">+</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span style="margin-right:0.05017em;" class="mord mathnormal">B</span><span style="margin-right:0.03588em;" class="mord mathnormal">y</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.686em;" class="vlist"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>Variables are stored three times in order to guarantee data consistency after system start up.<br>
Any change on any variable (ID 9, 14 or 17) will change others as well (ID 9, 14 and 17), once they refer to the same constant.</p>
<br>
<h3 class="toc-header" id="variable-linear-coefficient-ids-10-15-and-18"> Variable: Linear coefficient (IDs 10, 15 and 18)</h3>
<p>ID: 10, 15 and 18     Size: 2 bytes [Byte1|Byte0]     Read/Write</p>
<p>Linear coefficient for temperature calculation according to ADC value.</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>b</mi><mo>=</mo><mfrac><mrow><mo stretchy="false">(</mo><mi>B</mi><mi>y</mi><mi>t</mi><mi>e</mi><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo><mo>&lt;</mo><mo>&lt;</mo><mn>8</mn><mo stretchy="false">)</mo><mo>+</mo><mi>B</mi><mi>y</mi><mi>t</mi><mi>e</mi><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><mn>100</mn></mfrac></mrow>b = \frac{(Byte[1] &lt;&lt; 8) + Byte[0]}{100}
</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.69444em;vertical-align:0em;" class="strut"></span><span class="mord mathnormal">b</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span class="mrel">=</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span></span><span class="base"><span style="height:2.113em;vertical-align:-0.686em;" class="strut"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:1.427em;" class="vlist"><span style="top:-2.314em;"><span style="height:3em;" class="pstrut"></span><span class="mord"><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span></span></span><span style="top:-3.23em;"><span style="height:3em;" class="pstrut"></span><span style="border-bottom-width:0.04em;" class="frac-line"></span></span><span style="top:-3.677em;"><span style="height:3em;" class="pstrut"></span><span class="mord"><span class="mopen">(</span><span style="margin-right:0.05017em;" class="mord mathnormal">B</span><span style="margin-right:0.03588em;" class="mord mathnormal">y</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mopen">[</span><span class="mord">1</span><span class="mclose">]</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span class="mrel">&lt;</span><span class="mrel">&lt;</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span class="mord">8</span><span class="mclose">)</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mbin">+</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span style="margin-right:0.05017em;" class="mord mathnormal">B</span><span style="margin-right:0.03588em;" class="mord mathnormal">y</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.686em;" class="vlist"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>Variables are stored three times in order to guarantee data consistency after system start up.<br>
Any change on any variable (ID 10, 15 or 18) will change others as well (ID 10, 15 and 18), once they refer to the same constant.</p>
<br>
<h3 class="toc-header" id="variable-ad-reading-mode-id-11"> Variable: AD Reading Mode (ID 11)</h3>
<p>ID: 11     Size: 1 byte      Read/Write</p>
<p>In order to read temperature values, it must be 0. If, for any specific reason, user wants to read the last ADC raw value in variables 0 to 7, 1 should be written to "AD Reading Mode" variable. If it is desired to read the average from least 20 readings from one specific channel, variable value should be 2;</p>
<ul>
<li>0: Temperature reading (Op Mode variable (ID 12) must be 8) [DEFAULT VALUE AFTER STARTUP]</li>
<li>1: Last ADC raw value reading</li>
<li>2: Average from last 20 readings from one specific channel (Op Mode variable (ID 12) must not be 8)</li>
</ul>
<br>
<h3 class="toc-header" id="variable-reading-mode-id-12"> Variable: Reading Mode (ID 12)</h3>
<p>ID: 12     Size: 1 byte      Read/Write</p>
<p>This variable handles reading mode. If it is equal to 8 (default value after startup), sequential readings for all channels are performed.<br>
If it is between 0 and 7, readings will be performed only in the channel correlated, without temperature conversion. ADC values will be available for reading, according to variable AD Reading Mode (ID 11). Other channels may have invalid data.</p>
<p>8 IS THE DEFAULT VALUE AFTER STARTUP.</p>
<br>
<h2 class="toc-header" id="integration-to-epics"> Integration to EPICS</h2>
<p>The <a class="is-internal-link is-invalid-page" href="/Machine/Groups/CON/mbtemp/link">CON:SERIALxxCON|SERIALxxCON</a> board, based on Beaglebone Black Single Board Computer, will handle communication with up to 31 MBTemp boards. This SBC is the bridge between the hardware and the EPICS IOC, running on Controls Server, which publishes each temperature measured by a Pt100 sensor as a process variable.</p>
<p>This EPICS application is <a class="is-internal-link is-invalid-page" href="/Machine/Groups/CON/mbtemp/link">CON:Stream-IOC|Stream-IOC</a>, a StreamDevice-based EPICS IOC developed by the Controls Group to interface to EPICS.</p>
<br>
<h3 class="toc-header" id="linear-fit-correction"> Linear Fit Correction</h3>
<p>IOC deals with two variables to each channel: Temperature and Temperature-Raw</p>
<p>Temperature-Raw (Traw) is the value acquired from the board, linear fitted. Temperature value is calculated, based on the real quadratic equation and the value obtained from the board, which leads to:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>T</mi><mi>e</mi><mi>m</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>e</mi><mo>=</mo><mfrac><mrow><mo>−</mo><msub><mi>R</mi><mn>0</mn></msub><mi>B</mi><msqrt><mrow><msubsup><mi>R</mi><mn>0</mn><mn>2</mn></msubsup><msup><mi>B</mi><mn>2</mn></msup><mo>−</mo><mn>4</mn><mi>A</mi><msub><mi>R</mi><mn>0</mn></msub><mo stretchy="false">(</mo><mn>0.388</mn><mo>∗</mo><msub><mi>T</mi><mrow><mi>r</mi><mi>a</mi><mi>w</mi></mrow></msub><mo>+</mo><mn>100.03</mn><mo>−</mo><msub><mi>R</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow></msqrt></mrow><mrow><mn>2</mn><mi>A</mi><msub><mi>R</mi><mn>0</mn></msub></mrow></mfrac></mrow>Temperature = \frac{-{R_0}{B}\sqrt{R_0 ^2 B^2 - 4A R_0 (0.388*T_{raw} + 100.03 - R_0)}}{2A{R_0}}
</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.8777699999999999em;vertical-align:-0.19444em;" class="strut"></span><span style="margin-right:0.13889em;" class="mord mathnormal">T</span><span class="mord mathnormal">e</span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span><span class="mord mathnormal">e</span><span style="margin-right:0.02778em;" class="mord mathnormal">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">u</span><span style="margin-right:0.02778em;" class="mord mathnormal">r</span><span class="mord mathnormal">e</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span><span class="mrel">=</span><span style="margin-right:0.2777777777777778em;" class="mspace"></span></span><span class="base"><span style="height:2.466em;vertical-align:-0.8360000000000001em;" class="strut"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:1.63em;" class="vlist"><span style="top:-2.3139999999999996em;"><span style="height:3em;" class="pstrut"></span><span class="mord"><span class="mord">2</span><span class="mord mathnormal">A</span><span class="mord"><span class="mord"><span style="margin-right:0.00773em;" class="mord mathnormal">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.30110799999999993em;" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span style="height:2.7em;" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em;" class="vlist"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span style="height:3em;" class="pstrut"></span><span style="border-bottom-width:0.04em;" class="frac-line"></span></span><span style="top:-3.6802em;"><span style="height:3em;" class="pstrut"></span><span class="mord"><span class="mord">−</span><span class="mord"><span class="mord"><span style="margin-right:0.00773em;" class="mord mathnormal">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.30110799999999993em;" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span style="height:2.7em;" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em;" class="vlist"><span></span></span></span></span></span></span></span><span class="mord"><span style="margin-right:0.05017em;" class="mord mathnormal">B</span></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.9498em;" class="vlist"><span style="top:-3.2em;" class="svg-align"><span style="height:3.2em;" class="pstrut"></span><span style="padding-left:1em;" class="mord"><span class="mord"><span style="margin-right:0.00773em;" class="mord mathnormal">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.7959080000000001em;" class="vlist"><span style="top:-2.433692em;margin-left:-0.00773em;margin-right:0.05em;"><span style="height:2.7em;" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span style="height:2.7em;" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.26630799999999993em;" class="vlist"><span></span></span></span></span></span></span><span class="mord"><span style="margin-right:0.05017em;" class="mord mathnormal">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span style="height:0.740108em;" class="vlist"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span style="height:2.7em;" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mbin">−</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mord">4</span><span class="mord mathnormal">A</span><span class="mord"><span style="margin-right:0.00773em;" class="mord mathnormal">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.30110799999999993em;" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span style="height:2.7em;" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em;" class="vlist"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">0</span><span class="mord">.</span><span class="mord">3</span><span class="mord">8</span><span class="mord">8</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mbin">∗</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mord"><span style="margin-right:0.13889em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.151392em;" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span style="height:2.7em;" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right:0.02778em;" class="mord mathnormal mtight">r</span><span class="mord mathnormal mtight">a</span><span style="margin-right:0.02691em;" class="mord mathnormal mtight">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em;" class="vlist"><span></span></span></span></span></span></span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mbin">+</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mord">3</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mbin">−</span><span style="margin-right:0.2222222222222222em;" class="mspace"></span><span class="mord"><span style="margin-right:0.00773em;" class="mord mathnormal">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.30110799999999993em;" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span style="height:2.7em;" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em;" class="vlist"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-2.9098em;"><span style="height:3.2em;" class="pstrut"></span><span style="min-width:1.02em;height:1.28em;" class="hide-tail"><svg preserveAspectRatio="xMinYMin slice" viewBox="0 0 400000 1296" height="1.28em" width="400em"><path d="M263,681c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l0 -0
c4.7,-7.3,11,-11,19,-11
H40000v40H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M1001 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.2902em;" class="vlist"><span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.8360000000000001em;" class="vlist"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>